---
title: "ESS 575: Final Project"
author: "George Woolsey" 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    toc: false
    toc_depth: 3
linkcolor: blue
header-includes:
  - \usepackage{caption}
  - \captionsetup[figure]{labelformat=empty}
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding){ 
    out_dir <- '../';
    rmarkdown::render(inputFile, encoding = encoding, output_file=file.path(dirname(inputFile), out_dir, 'ESS575_FinalProject_GWoolsey.pdf')) 
  })
---

```{r setup, include=F}
# knit options
knitr::opts_chunk$set(
  echo = TRUE
  , warning = FALSE
  , message = FALSE
  , fig.height = 5
  , fig.width = 7
  , eval = TRUE
  , fig.align='center'
)
```

# Introduction

Global forests have contributed a large and persistent net removal of carbon from the atmosphere over the past century (Birdsey & Heath, 1995; Goodale et al., 2002; Pan et al., 2011). Established forests account for the entire terrestrial carbon sink and currently absorb about 30% of fossil fuel CO_2 emissions (Pan et al., 2011). By significantly slowing the rate of climate change, this carbon sink constitutes a valuable ecosystem service (Fahey et al., 2010; Keenan & Williams, 2018). There are increasing worries that these sinks will weaken and may eventually reverse to carbon sources as the global climate warms and CO_2 emissions fall (Peñuelas et al., 2017; Denning, 2022).

Fire suppression, land use change, and climate change over the last 150 years have shifted forest composition in the USA (Houghton, Hackler, & Lawrence, 1999; Gallant et al., 2003). The resulting forests are substantially more dense with homogeneous structure, higher density of late seral species, and high surface fuel loads and ladder fuels connecting surface to crown fuels (Savage et al. 2013, Battaglia et al. 2018). Denser, more uniform forests are more vulnerable to mortality from fire, drought, disease, insect infestations, and weather damage (Dale et al., 2001). These impacts are especially pronounced in the western USA where disturbances are leading to substantial abrupt landscape alterations and significant carbon emissions from forests (Stephens, 2005; Zhang et al., 2012; Hicke et al., 2013; Rodman et al., 2020; Hagmann et al., 2021). There has recently been great emphasis on silvicultural practices and management strategies that increase forest resistance and resilience to disturbance and climate change (Millar et al., 2007; DeRose & Long, 2014; Hessburg et al., 2021; Prichard et al., 2021). Fuel reduction treatments, including partial harvest, prescribed burning, and coupled forest thinning and burning can reduce the potential for carbon losses from disturbance and stabilize forest carbon sinks (Hessburg et al., 2021; Prichard et al. 2021).

In this study, Net Primary Productivity (NPP) was used to quantify forest resistance and resilience and evaluate the relative effects of management actions in mediating responses to compound disturbances in a forested ecosystem. The primary research question is: How do forest management treatments interact with bark beetle disturbance to influence forest resistance and resilience to wildfire? The objective of this analysis is to assess how post-wildfire forest regrowth is influenced by prior forest management and biotic disturbance to inform evaluations of the trade-offs between fire mitigation, timber harvest, and forest carbon.

# Data and Research design 

The study area for this analysis is the 35,600 ha (88,000 acres) that burned during the [2013 West Fork and Papoose Fires](https://www.fs.usda.gov/detail/riogrande/home/?cid=stelprdb5425999) on the Rio Grande National Forest (Colorado, USA). A portion of this fire footprint was impacted by spruce bark beetle (*Dendroctonus rufipennis*) beginning in 2009-2010 to the time of the fire disturbance in 2013. The wildfire perimeter was acquired from the Monitoring Trends in Burn Severity ([MTBS](https://www.mtbs.gov/direct-download)) program (Eidenshink et al. 2007) and data from the Forest Health Monitoring ([FHM](https://www.fs.usda.gov/detail/r2/forest-grasslandhealth/?cid=fsbdev3_041629)) program of the US Department of Agriculture's Forest Service (USFS) was used to identify beetle-impacted areas (USFS, 2021). Between 2009 and 2013 some of the beetle-killed stands were salvage logged to reduce subsequent fire hazard and recover forest timber value. This area has a history of timber harvests and fuel reduction treatments that occurred prior to the 2009-2013 beetle outbreak and 2013 wildfire. Forest management activities including fuel treatments, timber harvests, and salvage logging were identified using the Forest Service Activity Tracking System (FACTS; USFS, 2022). This pre-existing patchwork of silvicultural prescriptions and beetle disturbance along with non-treated, and non-beetle impacted stands provides a natural experiment opportunity for examining how treatments interact with disturbance to influence subsequent forest regrowth and carbon fixation. We examine post-wildfire forest regrowth for 6 unique silvicultural treatment and natural disturbance interaction histories (Figure 1).

Our response variable is post-wildfire (2014-2022), pixel-level annual NPP from the Landsat Net Primary Production CONUS data product which estimates NPP calculated using the MOD17 algorithm (Running & Zhao, 2015) and Landsat Surface Reflectance at 30-m spatial resolution (Robinson et al. 2018). This data estimates the total amount of carbon allocated to plant tissue (above- and below-ground) after accounting for plant respiration by integrating meteorological data, land cover by plant functional type, and optical remote sensing data. We account for spatial variability in water availability, a primary driver of post-disturbance forest regrowth (Rodman et al., 2020; Hoylman et al., 2021), by including annual climatic water deficit (CWD; deficit = potential evapotranspiration [PET] - actual evapotranspiration [AET]; Stephenson, 1998) as an explanatory variable. An annual (2014-2022) CWD measurement was attached to each 30-m pixel based on a gridded climate dataset at 250-m resolution (Abatzoglou et al., 2018).

```{r, eval=FALSE, echo=FALSE, out.width="100%", out.height="100%", fig.cap="", fig.align='center'}
knitr::include_graphics("../data/xxx.jpg")
```

**Figure 1.** Silvicultural treatment and natural disturbance interaction matrix representing the 6 group-level classifications in the Bayesian dynamic hierarchical model utilized in this analysis

# Model 

The modelling objective in this analysis is to fit a logistic growth model for forest regrowth using the Landsat Net Primary Production (NPP) data product while accounting for variance in modelling the ecological process unrelated to forest regrowth. A Bayesian dynamic hierarchical model (i.e., a "state-space" model) was developed to obtain posterior distributions of the latent state and parameters of interest. The hierarchical model implemented and described below includes a model of the ecological process (unobserved latent state), a model linking the process to observed data, and models for parameters. The final model predicts forest NPP regrowth at the pixel level (*i*) for each of the 6 possible treatment, disturbance interactions (*j*), for each year (*t*) over a 9-year regrowth period.

```{r, echo=FALSE, out.width="80%", out.height="80%", fig.cap="", fig.align='center'}
knitr::include_graphics("../data/DAG.jpg")
```

**Figure 2.** Hierarchical Bayesian model of the dynamics of forest productivity (NPP) regrowth on the Rio Grande National Forest (Colorado, USA) following the 2013 West Fork Fire Complex. The true NPP for 30-m pixel *i* in treatment, disturbance interaction group *j* at time *t* is modeled using the deterministic model (Eqn. 1), which represents the effects of the true, unobserved NPP ($z_{ijt}$); the climatic water deficit ($x_{ijt}$); and their interaction on forest regrowth. See below for interpretation of the $\boldsymbol{\beta}$ parameters. The data model relates observed values of NPP ($y_{ijt}$) at pixel *i* in treatment, disturbance interaction group *j* at time *t* to the latent state ($z$). The solid lines show stochastic relationships while the dashed lines show deterministic relationships, implying that the quantities at the tails of the arrows are known without error (Hobbs & Hooten, 2015).

## Deterministic model:

The logistic growth model was implemented as the ecological process model of forest regrowth. Several studies have shown that the typical trajectory of forest NPP overtime following stand-replacing disturbance is represented by a rapid initial increase with a modest decline thereafter (Gower et al., 1996; Law et al., 2003; Pregitzer & Euskirchen, 2004; Goulden et al., 2011). The logistic growth model has been applied widely to forest growth dynamics including models of forest succession and dispersion (Acevedo et al., 2012; Richit et al., 2019).

Forest regrowth rates are not constant over time as they depend on existing forest cover, that is, they are density dependent. The logistic growth model allows us to predict next year's forest productivity (NPP) but it is always dependent on the previous year's productivity. In the beginning (under zero forest cover conditions), forest regrowth is nearly exponential, with increases close to the maximum instantaneous growth rate $r_{max}$. There is a constant linear decrease in the instantaneous growth rate ($r$) as forest cover increases. Forest growth eventually plateaus and fluctuates around the carrying capacity ($K$) which represents the maximum forest cover at which the instantaneous growth rate ($r$) is 0. The strength of density dependence is represented by $\frac{r_{max}}{K}$, where a negative ratio would indicate that the growth rate decreases with increasing forest cover.

The deterministic model used to represent the ecological process is a special form of the logistic growth model, the Ricker equation, which accounts for density-dependent growth:

\begin{align*}
z_{ijt} = g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt}) &= z_{ijt-1}e^{(\beta_{0j} \,+\, \beta_{1j} \cdot z_{ijt-1} \,+\, \beta_{2j}  \cdot x_{ijt} \,+\, \beta_{3j}  \cdot z_{ijt-1}  \cdot x_{ijt})}  \\
x &= \textrm{ climatic water deficit}
\end{align*}

The process model of the unobserved, true NPP ($z_{ijt}$) is indexed by the subscripts: 

* *i* representing annual observations of NPP at the 30-m pixel level
* *j* representing each of the 6 possible treatment, disturbance interactions (Figure 1)
* *t* denoting each of the 9 years spanning the regrowth period 2014 to 2022

The biological interpretation of the $\boldsymbol{\beta}$ parameters are:

* $\beta_{0j}$, the intercept, is analogous to the intrinsic, maximum forest growth rate ($r_{max}$) when forest cover is 0 and climatic water deficit is average for treatment, disturbance interaction *j*

* $\beta_{1j}$ slope represents the magnitude of forest competition (i.e., the strength of density dependence) for treatment, disturbance interaction *j*. In the Stochastic Ricker (logistic) Model $\beta_{1j} = \frac{r_{max}}{K}$, where $K$ is the carrying capacity

* $\beta_{2j}$ slope is a measure of the strength of the effect of variation in climatic water deficit for treatment, disturbance interaction *j*

* $\beta_{3j}$ slope represents the magnitude of the effect of climatic water deficit on the effect of density for treatment, disturbance interaction *j*

See Hobbs & Hooten (2015, p.11) for a more thorough description of this model for representing density-dependent growth.

## Process model

The modelling objective is to fit a logistic growth model for forest regrowth using remotely-sensed, modeled NPP data while accounting for variance in modelling the ecological process unrelated to forest regrowth. The deterministic model of the unobserved latent state variable $z$, which represents "true" NPP, is an imperfect representation of the ecological process of forest regrowth and is subject to process error. The process variance ($\sigma^{2}_{p}$) in the deterministic model accounts for the failure of the model to represent all the influences on the true state.

The process model uses a lognormal distribution for the latent state ($z$) to represent the strictly non-negative, true value of NPP:

$$
z_{ijt} \sim {\sf lognormal} \biggl(\log \bigl( g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt})  \bigr)  , \sigma^{2}_{p} \biggr)
$$

## Data model

The data model relates observed values of NPP ($y_{ijt}$) at pixel *i* in treatment, disturbance interaction group *j* at time *t* to the latent state $z_{ijt}$:


$$
y_{ijt} \sim {\sf lognormal} \bigl(z_{ijt}, \sigma^{2}_{d} \bigr)
$$

To represent sources of noise related to measurement error (e.g. failure to perfectly observe NPP from  optical satellite remote sensing; imperfections of the algorithm used to model NPP), observed NPP is modeled as draws from a lognormal distribution with $z$ as the mean value and a variance term $\sigma^{2}_{d}$. The magnitude of the observation uncertainty ($\sigma^{2}_{p}$) represents measurement error. Future work building on the dynamic hierarchical model presented here could integrate analysis of the relationship between fine-scale flux tower measurements and satellite-based estimates of NPP (e.g. Jay et al., 2016) to relate the unobserved, true NPP to observed NPP.

## Full Model

The full model, including prior distributions, is specified by the following statement in which items in bold represent matrices:


\begin{align*}
\bigl[ \boldsymbol{z},\boldsymbol{\beta},\boldsymbol{\mu_{\beta}}, \sigma^{2}_{p}, \sigma^{2}_{d} \mid \boldsymbol{y} \bigr] &\propto \\
&\prod_{i=1}^{n}\prod_{j=1}^{6}\prod_{t=2}^{9} {\sf lognormal} \bigl(y_{ijt} \mid z_{ijt}, \sigma^{2}_{d} \bigr) \\ 
&\times \; {\sf lognormal} \biggl(z_{ijt} \biggm| \log \bigl( g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt})  \bigr)  , \sigma^{2}_{p} \biggr)\\
&\times \; {\sf normal} \bigr( z_{ij1} \mid y_{ij1} \bigr) \\
&\times \; {\sf uniform} \bigr( \sigma^{2}_{p} \mid 0, 1 \bigr) \\
&\times \; {\sf uniform} \bigr( \sigma^{2}_{d} \mid 0, 1 \bigr) \\
&\times \; \text{multivariate normal}\left(\left(\begin{array}{c}
\beta_{0j}\\
\beta_{1j}\\
\beta_{2j}\\
\beta_{3j}
\end{array}\right) \bigg|
\left(\begin{array}{c}
\mu_{\beta_{0}}\\
\mu_{\beta_{1}}\\
\mu_{\beta_{2}}\\
\mu_{\beta_{3}}
\end{array}\right)
,\boldsymbol{\Sigma}\right) \\
&\times \; \text{Wishart} \left(\boldsymbol{\Sigma} \, \bigg|
\left(\begin{array}{cccc}
1 & 0 & 0  & 0 \\
0 & 1 & 0  & 0 \\
0 & 0 & 1  & 0 \\
0 & 0 & 0  & 1
\end{array}\right)
,4+1\right) \\
&\times \, \prod_{k=0}^{3} {\sf normal} \bigr( \mu_{\beta_{k}} \mid 0,100000 \bigr)
\end{align*}

Our hypothesis is that different treatment and disturbance interaction groups had different levels of resistance to the fire disturbance (represented by the model intercept) and also different post-fire recovery patterns (represented by the slope of the model). To test this hypothesis, we model group (subscript *j*) effects on intercepts and slopes. In order to understand group effects on multiple parameters ($\beta_{j0}, \beta_{j1},\beta_{j2},\beta_{j3}$ in our model), we account for the way that the parameters covary using a scaled inverse-Wishart model. See Gelman and Hill (2009, pg. 376) for details. The covariance matrix $\boldsymbol{\Sigma}$ (i.e., variance covariance matrix) is an $m \times m$ matrix with ones on the diagonal and zeros on the off diagonals where $m$ is the number of coefficients including the intercept. Normal priors on the model coefficients ($\boldsymbol{\beta}$) were uninformative.

Uniformly distributed vague priors were utilized for the process error ($\sigma^{2}_{p}$) and the measurement error ($\sigma^{2}_{d}$).

# Analysis 

Write a section that describes the computational procedures you will use, tests for convergence, and posterior predictive checks. Describe any important derived quantities. This should read the like the section you would write for a paper to be submitted to a journal. Consult published Bayesian papers for examples.


\newpage

# References

Abatzoglou, J. T., Dobrowski, S. Z., Parks, S. A., & Hegewisch, K. C. (2018). TerraClimate, a high-resolution global dataset of monthly climate and climatic water balance from 1958–2015. Scientific data, 5(1), 1-12.

Andrus, R. A., Veblen, T. T., Harvey, B. J., & Hart, S. J. (2016). Fire severity unaffected by spruce beetle outbreak in spruce‐fir forests in southwestern Colorado. Ecological applications, 26(3), 700-711.

Colorado State Forest Service. (2018). Report on the Health of Colorado’s Forests. Colorado State Forest Service. Colorado State University, Fort Collins, Colorado.

Davis, T. S., Meddens, A. J., Stevens‐Rumann, C. S., Jansen, V. S., Sibold, J. S., & Battaglia, M. A. (2022). Monitoring resistance and resilience using carbon trajectories: Analysis of forest management–disturbance interactions. Ecological Applications, 32(8), e2704.

Dobor, L., Hlásny, T., Rammer, W., Zimová, S., Barka, I., & Seidl, R. (2020). Is salvage logging effectively dampening bark beetle outbreaks and preserving forest carbon stocks?. Journal of Applied Ecology, 57(1), 67-76.

Eidenshink, J., Schwind, B., Brewer, K., Zhu, Z. L., Quayle, B., & Howard, S. (2007). A project for monitoring trends in burn severity. Fire ecology, 3(1), 3-21.

Gelman, A., & Hill, J. (2009). Data analysis using regression and multilevel/hierarchical models. Cambridge university press.

Hicke, J. A., Johnson, M. C., Hayes, J. L., & Preisler, H. K. (2012). Effects of bark beetle-caused tree mortality on wildfire. Forest Ecology and Management, 271, 81-90.

Hicke, J. A., Meddens, A. J., Allen, C. D., & Kolden, C. A. (2013). Carbon stocks of trees killed by bark beetles and wildfire in the western United States. Environmental Research Letters, 8(3), 035032.

Hobbs, N. T., & Hooten, M. B. (2015). Bayesian Models: A Statistical Primer for Ecologists. Princeton University Press.

Hoylman, Z. H., Jencso, K., Archer, V., Efta, J. A., Holden, Z. A., Ballantyne, A. P., & Johnson, M. (2021). The influence of hydroclimate and management on forest regrowth across the western US. Environmental Research Letters, 16(6), 064057.

Jay, S., Potter, C., Crabtree, R., Genovese, V., Weiss, D. J., & Kraft, M. (2016). Evaluation of modelled net primary production using MODIS and landsat satellite data fusion. Carbon Balance and Management, 11(1), 1-13.

Stephenson, N. (1998). Actual evapotranspiration and deficit: biologically meaningful correlates of vegetation distribution across spatial scales. Journal of biogeography, 25(5), 855-870.

[USFS] United States Department of Agriculture, Forest Service. (2021). Forest Insect and Disease Conditions in the Rocky Mountain Region, 2020. Fort Collins, CO: USDA Forest Service, Rocky Mountain Region, Forest Health, R2– RO–21-01.

[USFS] United States Department of Agriculture, Forest Service. (2022). Forest Service Activity Tracking System (FACTS). Geospatial Technology and Applications Center, Salt Lake City, Utah, USA. Accessed 2022-12-31 at: http://data.fs.usda.gov/geodata/edw/datasets.php.

Verdin, K. L., Dupree, J. A., & Stevens, M. R. (2013). Postwildfire debris-flow hazard assessment of the area burned by the 2013 West Fork Fire Complex, southwestern Colorado. US Department of the Interior, US Geological Survey.