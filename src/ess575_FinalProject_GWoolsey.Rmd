---
title: "ESS 575: Final Project"
author: "George Woolsey" 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    toc: false
    toc_depth: 3
linkcolor: blue
header-includes:
  - \usepackage{caption}
  - \captionsetup[figure]{labelformat=empty}
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding){ 
    out_dir <- '../';
    rmarkdown::render(inputFile, encoding = encoding, output_file=file.path(dirname(inputFile), out_dir, 'ESS575_FinalProject_GWoolsey.pdf')) 
  })
---

```{r setup, include=F}
# knit options
knitr::opts_chunk$set(
  echo = TRUE
  , warning = FALSE
  , message = FALSE
  , fig.height = 5
  , fig.width = 7
  , eval = TRUE
  , fig.align='center'
)
```

# Introduction

In this particular example we ask the question: How does variation in weather modify feedbacks between population density and population growth rate in a population of large herbivores occupying a landscape where precipitation is variable in time? Answering this question requires a model that portrays density dependence, effects of precipitation, and their interaction.

Write a brief introduction to the problem you are studying. The first few sentences should provide the broad context –why is the general topic important to the discipline of ecology, citing a few key papers. Proceed to explain why your specific work will advance understanding of the broad topic. Describe the core questions and or objectives of the work. The introduction should resemble a funnel – big topics at the top narrowing to specific questions at the bottom. You want to convince the reader that your specific model system is well poised to provide general insight in ecology. By the way, this is how all papers and proposals should begin.

We use NPP to quantify resistance and resilience and evaluate the relative effects of two commonly implemented silvicultural systems in mediating responses to a spatially expansive and extreme disturbance across a subalpine forest landscape. In the southern Rocky Mountains, a recent outbreak beginning 2009–2010 of the spruce bark beetle (Dendroctonus rufipennis Kirby) resulted in the death of millions of mature trees, and some agencies estimate a loss of 1 M ha of forest canopy cover in the state of Colorado alone due to these events (Colorado State Forest Service, 2018). The tree species primarily impacted by this event is Engelmann spruce (Picea engelmannii), a slow-growing, shade-tolerant conifer. There is general concern among forest managers, the scientific community, and the public about whether this outbreak will have long-term consequences for forest growth and composition (Schapira et al., 2021). In our study region (Figure 2), shelterwood silvicultural systems are commonly implemented and intended to increase establishment of seedling cohorts (WindmullerCampione et al., 2017); shelterwood is also a potential management approach for increasing resistance and resilience to bark beetle outbreaks. The shelterwood method requires a series of entries, typically (1) a preparatory cut that removes up to 10% of the stand basal area, keeping species intended for recruitment in a regular spatial arrangement and removing undesirable species, (2) a second establishment cut removes another 20%–30% is intended to prepare a seedbed and increase growing space for recruitment, and (3) an overstory removal cut to release established seedlings/saplings from competition with dominant trees (Alexander, 1987; Deal, 2018). Shelterwood treatments might therefore be associated with resistance or resilience of spruce forests to bark beetle outbreaks if pre-outbreak reductions in tree density, competitive release of surviving trees, or the rapid regrowth of seedling cohorts following outbreak are associated with detectable losses or gains in forest productivity, respectively. Approximately 20 years prior to the outbreak, shelterwood cuts were implemented across the study landscape; at the time of the outbreak shelterwood stands were early in their sequence of treatments (i.e., only preparatory/establishment cuts had been implemented) and forest structure resembled a multi-aged system. In addition, salvage logging was implemented throughout the region in some post-outbreak stands to recover economic value from timber resources damaged by spruce beetle. This pre-existing patchwork of silvicultural prescriptions (shelterwood preparatory/ establishment cuts and salvage logging) with differing objectives, along with nearby non-treated stands in wilderness areas, provides a tractable opportunity for examining how treatments interact with resistance and resilience in relation to forest carbon fixation.

```{r, echo=FALSE, out.width="100%", out.height="100%", fig.cap="", fig.align='center'}
knitr::include_graphics("../data/WFF_map.jpg")
```

**Fig. 1.** 2013 West Fork Fire Complex on the Rio Grande National Forest (Colorado, USA) courtesy of (Verdin, Dupree, & Stevens, 2013)

```{r, echo=FALSE, out.width="100%", out.height="100%", fig.cap="", fig.align='center'}
knitr::include_graphics("../data/xxx.jpg")
```

**Fig. 2.** Management treatment and natural disturbance interaction matrix representing the 6 group-level classifications () in the Bayesian dynamic hierarchical model utilized in this analysis


# Data and Research design 

Describe the data that you will use to fit models and how they were collected. Imagine that you were giving me one of the word problems on writing hierarchical models I gave you (payback). I need to know enough to be able to write the model myself. I don’t need to know details of methods for data collection, but I do need to understand the design. Explain spatial and or temporal structure of the data and describe sources of calibration and sampling uncertainty

# Model 

The modelling objective in this analysis is to fit a logistic growth model for forest regrowth using the Landsat Net Primary Production (NPP) data product while accounting for variance in modelling the ecological process unrelated to forest regrowth. A Bayesian dynamic hierarchical model (i.e., a "state-space" model) was developed to obtain posterior distributions of the latent state and parameters of interest. The hierarchical model implemented and described below includes a model of the ecological process (unobserved latent state), a model linking the process to observed data, and models for parameters. The final model predicts forest NPP regrowth at the pixel level (*i*) for each of the 6 possible treatment, disturbance interactions (*j*), for each year (*t*) over a 9-year regrowth period.

```{r, echo=FALSE, out.width="80%", out.height="80%", fig.cap="", fig.align='center'}
knitr::include_graphics("../data/DAG.jpg")
```

**Fig. 3.** Hierarchical Bayesian model of the dynamics of forest productivity (NPP) regrowth on the Rio Grande National Forest (Colorado, USA) following the 2013 West Fork Fire Complex. The true NPP for 30-m pixel *i* in treatment, disturbance interaction group *j* at time *t* is modeled using the deterministic model (Eqn. 1), which represents the effects of the true, unobserved NPP ($z_{ijt}$); the climatic water deficit ($x_{ijt}$); and their interaction on forest regrowth. See below for interpretation of the $\boldsymbol{\beta}$ parameters. The data model relates observed values of NPP ($y_{ijt}$) at pixel *i* in treatment, disturbance interaction group *j* at time *t* to the latent state ($z$). The solid lines show stochastic relationships while the dashed lines show deterministic relationships, implying that the quantities at the tails of the arrows are known without error (Hobbs & Hooten, 2015).

## Deterministic model:

The logistic growth model was implemented as the ecological process model of forest regrowth. Several studies have shown that the typical trajectory of forest NPP overtime following stand-replacing disturbance is represented by a rapid initial increase with a modest decline thereafter (Gower et al., 1996; Law et al., 2003; Pregitzer & Euskirchen, 2004; Goulden et al., 2011). The logistic growth model has been applied widely to forest growth dynamics including models of forest succession and dispersion (Acevedo et al., 2012; Richit et al., 2019).

Forest regrowth rates are not constant over time as they depend on existing forest cover, that is, they are density dependent. The logistic growth model allows us to predict next year's forest productivity (NPP) but it is always dependent on the previous year's productivity. In the beginning (under zero forest cover conditions), forest regrowth is nearly exponential, with increases close to the maximum instantaneous growth rate $r_{max}$. There is a constant linear decrease in the instantaneous growth rate ($r$) as forest cover increases. Forest growth eventually plateaus and fluctuates around the carrying capacity ($K$) which represents the maximum forest cover at which the instantaneous growth rate ($r$) is 0. The strength of density dependence is represented by $\frac{r_{max}}{K}$, where a negative ratio would indicate that the growth rate decreases with increasing forest cover.

The deterministic model used to represent the ecological process is a special form of the logistic growth model, the Ricker equation, which accounts for density-dependent growth:

**Eqn. 1**

$$
\begin{align*}
z_{ijt} = g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt}) &= z_{ijt-1}e^{(\beta_{0j} \,+\, \beta_{1j} \cdot z_{ijt-1} \,+\, \beta_{2j}  \cdot x_{ijt} \,+\, \beta_{3j}  \cdot z_{ijt-1}  \cdot x_{ijt})}  \\
x &= \textrm{ climatic water deficit}
\end{align*}
$$

The process model of the unobserved, true NPP ($z_{ijt}$) is indexed by the subscripts: 

* *i* representing annual observations of NPP at the 30-m pixel level
* *j* representing each of the 6 possible treatment, disturbance interactions (Fig. 2)
* *t* denoting each of the 9 years spanning the regrowth period 2014 to 2022

The biological interpretation of the $\boldsymbol{\beta}$ parameters are:

* $\beta_{0j}$, the intercept, is analogous to the intrinsic, maximum forest growth rate ($r_{max}$) when forest cover is 0 and climatic water deficit is average for treatment, disturbance interaction *j*

* $\beta_{1j}$ slope represents the magnitude of forest competition (i.e., the strength of density dependence) for treatment, disturbance interaction *j*. In the Stochastic Ricker (logistic) Model $\beta_{1j} = \frac{r_{max}}{K}$, where $K$ is the carrying capacity

* $\beta_{2j}$ slope is a measure of the strength of the effect of variation in climatic water deficit for treatment, disturbance interaction *j*

* $\beta_{3j}$ slope represents the magnitude of the effect of climatic water deficit on the effect of density for treatment, disturbance interaction *j*

See Hobbs & Hooten (2015, p.11) for a more thorough description of this model for representing density-dependent growth.

## Process model

The modelling objective is to fit a logistic growth model for forest regrowth using remotely-sensed, modeled NPP data while accounting for variance in modelling the ecological process unrelated to forest regrowth. The deterministic model of the unobserved latent state variable $z$, which represents "true" NPP, is an imperfect representation of the ecological process of forest regrowth and is subject to process error. The process variance ($\sigma^{2}_{p}$) in the deterministic model accounts for the failure of the model to represent all the influences on the true state.

The process model uses a lognormal distribution for the latent state ($z$) to represent the strictly non-negative, true value of NPP:

$$
z_{ijt} \sim {\sf lognormal} \biggl(\log \bigl( g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt})  \bigr)  , \sigma^{2}_{p} \biggr)
$$

## Data model

The data model relates observed values of NPP ($y_{ijt}$) at pixel *i* in treatment, disturbance interaction group *j* at time *t* to the latent state $z_{ijt}$:


$$
y_{ijt} \sim {\sf lognormal} \bigl(z_{ijt}, \sigma^{2}_{d} \bigr)
$$

To represent sources of noise related to measurement error (e.g. failure to perfectly observe NPP from  optical satellite remote sensing; imperfections of the algorithm used to model NPP), observed NPP is modeled as draws from a lognormal distribution with $z$ as the mean value and a variance term $\sigma^{2}_{d}$. The magnitude of the observation uncertainty ($\sigma^{2}_{p}$) represents measurement error. Future work building on the dynamic hierarchical model presented here could integrate analysis of the relationship between fine-scale flux tower measurements and satellite-based estimates of NPP (e.g. Jay et al., 2016) to relate the unobserved, true NPP to observed NPP.

## Full Model

The full model, including prior distributions, is specified by the following statement in which items in bold represent matrices:

$$
\left(\left(\begin{array}{c}
\mu_{\alpha}\\
\mu_{\alpha}\\
\mu_{\beta}
\end{array}\right),\boldsymbol{\Sigma}\right)
$$


$$
\begin{align*}
\bigl[ \boldsymbol{z},\boldsymbol{\beta},\boldsymbol{\mu_{\beta}}, \sigma^{2}_{p}, \sigma^{2}_{d} \mid \boldsymbol{y} \bigr] &\propto \\
&\prod_{i=1}^{n}\prod_{j=1}^{6}\prod_{t=2}^{9} {\sf lognormal} \bigl(y_{ijt} \mid z_{ijt}, \sigma^{2}_{d} \bigr) \\ 
&\times \; {\sf lognormal} \biggl(z_{ijt} \biggm| \log \bigl( g(\boldsymbol{\beta}_j, z_{ijt-1}, x_{ijt})  \bigr)  , \sigma^{2}_{p} \biggr)\\
&\times \; {\sf normal} \bigr( z_{ij1} \mid y_{ij1} \bigr) \\
&\times \; \text{multivariate normal}\left(\left(\begin{array}{c}
  \beta_{0j}\\
  \beta_{1j}\\
  \beta_{2j}\\
  \beta_{3j}
\end{array}\right) \bigg|
\left(\begin{array}{c}
  \mu_{\beta_{0}}\\
  \mu_{\beta_{1}}\\
  \mu_{\beta_{2}}\\
  \mu_{\beta_{3}}
\end{array}\right)
,\boldsymbol{\Sigma}\right) \\
&\times \; {\sf Wishart} \left(\boldsymbol{\Sigma} \, \bigg|
\left(\begin{array}{c}
  1 & 0 & 0  & 0 \\
  0 & 1 & 0  & 0 \\
  0 & 0 & 1  & 0 \\
  0 & 0 & 0  & 1
\end{array}\right)
,4+1\right) \\

  
\end{align*}
$$


\begin{pmatrix}
1 & 2 & 3\\
a & b & c
\end{pmatrix}
&\times \; {\sf beta} \bigr( \phi \mid 154,792) \\
&\times \; {\sf uniform} \bigr( \lambda \mid 0,1) \\ 
&\times \; {\sf uniform} \bigr( \sigma^{2}_{p} \mid 0,1) \\ 




helicopter is estimated separately for each unit.
We chose vague priors for two parameters for
which we had no prior information: process error
(r2
p) and the effects of climate (bclimate). 

# Analysis 

Write a section that describes the computational procedures you will use, tests for convergence, and posterior predictive checks. Describe any important derived quantities. This should read the like the section you would write for a paper to be submitted to a journal. Consult published Bayesian papers for examples.


and σ 2 o is observation variance that accounts for the uncertainty caused by the difference between the true state and our observation of the true state. 10 The model is hierarchical because z t appears on both sides of the conditioning. The dynamics in this model are known as ﬁrst-order “Markovian” because the process depends on itself in time only through its most recent value. We want to know the probability distribution of the true state at some future point in time conditional on the observations of the state in the past. If the observed data extend from t = 1 , ..., T , we seek to make inferences about z t > T . These inferences are forecasts (sensu Clark, 2003b; Cressie and Wikle, 2011) because they are predictions of the future state accompanied by proper estimates of uncertainty. Predictive inference is commonly desired for the data ( y T + 1 ) and/or latent process ( z T + 1 ), where the subscript T + 1 indicates one time interval into the future, or at least a time extending beyond the period of data collection. In the case of the inference on the data ( y T + 1 ), we seek the usual posterior predictive distribution, as previously described:
Hobbs, N. Thompson, and Mevin B. Hooten. Bayesian Models : A Statistical Primer for Ecologists, Princeton University Press, 2015. ProQuest Ebook Central, http://ebookcentral.proquest.com/lib/csu/detail.action?docID=1983781.
Created from csu on 2022-12-10 00:02:35.


\newpage

# References

Verdin, K. L., Dupree, J. A., & Stevens, M. R. (2013). Postwildfire debris-flow hazard assessment of the area burned by the 2013 West Fork Fire Complex, southwestern Colorado. US Department of the Interior, US Geological Survey.

Jay, S., Potter, C., Crabtree, R., Genovese, V., Weiss, D. J., & Kraft, M. (2016). Evaluation of modelled net primary production using MODIS and landsat satellite data fusion. Carbon Balance and Management, 11(1), 1-13.

